<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donate Blood - Pulse Chain GIKI</title>
    <link rel="icon" type="image/png" href="PICS/Pulse Chain GIKI.png">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/donate.css">
</head>
<body>
    <div class="container">
        <header>
            <h1 style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 48px; height: 48px; flex-shrink: 0; margin: 0; padding: 0; display: block; margin-top: -4px;">
                    <path d="M12 2c-2.5 0-4.5 2-4.5 4.5 0 3 4.5 7.5 4.5 7.5s4.5-4.5 4.5-7.5c0-2.5-2-4.5-4.5-4.5z" fill="currentColor" transform="scale(1 -1) translate(0 -24)"/>
                </svg>
                <span>Pulse Chain GIKI</span>
            </h1>
            <p>Donate Blood</p>
        </header>


        <div class="card" style="max-width: 700px; margin: 0 auto;">
            <h2 style="text-align: center; color: var(--text-primary); margin-bottom: 30px;">Donor Information Form</h2>
            <p style="text-align: center; color: var(--text-secondary); margin-bottom: 30px;">
                Please fill in your details to register as a blood donor. Your information will help connect you with those in need.
            </p>

            <form id="donateForm">
                <div class="form-group">
                    <label for="fullName">Full Name *</label>
                    <input type="text" id="fullName" name="fullName" required>
                </div>

                <div class="form-group">
                    <label for="age">Age *</label>
                    <input type="number" id="age" name="age" min="18" max="65" required>
                </div>

                <div class="form-group">
                    <label for="gender">Gender *</label>
                    <select id="gender" name="gender" required>
                        <option value="">Select Gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="bloodGroup">Blood Group *</label>
                    <select id="bloodGroup" name="bloodGroup" required>
                        <option value="">Select Blood Group</option>
                        <option value="A+">A+</option>
                        <option value="A-">A-</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="contact">Contact Number *</label>
                    <input type="tel" id="contact" name="contact" required>
                </div>

                <div class="form-group">
                    <label for="availability">Donor Availability *</label>
                    <select id="availability" name="availability" required>
                        <option value="">Select Availability</option>
                        <option value="Yes">Yes, Available</option>
                        <option value="No">No, Not Available</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="medicalNote">Medical Notes (Optional)</label>
                    <textarea id="medicalNote" name="medicalNote" placeholder="Any medical conditions or notes..."></textarea>
                </div>

                <button type="submit" class="btn btn-primary btn-block">Submit Donor Information</button>
            </form>
        </div>

        <div class="back-to-dashboard-container">
            <a href="index.html" class="btn-back-to-dashboard">‚Üê Back to Dashboard</a>
        </div>
    </div>

    <script type="module">
        import { addDonor } from './js/donor.js';
        import { getCurrentUser, onAuthStateChange } from './js/login.js';
        import { showSuccessToast, showErrorToast } from './js/toast.js';

        const donateForm = document.getElementById('donateForm');

        // Check auth state
        onAuthStateChange((user) => {
            if (!user) {
                window.location.href = 'index.html';
            }
        });

        donateForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const user = getCurrentUser();
            const formData = {
                fullName: document.getElementById('fullName').value,
                age: parseInt(document.getElementById('age').value),
                gender: document.getElementById('gender').value,
                bloodGroup: document.getElementById('bloodGroup').value,
                contact: document.getElementById('contact').value,
                availability: document.getElementById('availability').value,
                medicalNote: document.getElementById('medicalNote').value,
                userEmail: user ? user.email : '',
                userId: user ? user.uid : ''
            };

            const result = await addDonor(formData);

            if (result.success) {
                showSuccessToast('Donor information submitted successfully! Thank you for your contribution.');
                setTimeout(() => {
                    donateForm.reset();
                }, 2000);
            } else {
                showErrorToast(result.error || 'Failed to submit donor information. Please try again.');
            }
        });
    </script>
</body>
</html>

