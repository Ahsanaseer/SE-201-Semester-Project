<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donate Blood - Pulse Chain GIKI</title>
    <link rel="icon" type="image/png" href="PICS/Pulse Chain GIKI.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/donate.css">
</head>

<body>
    <div class="container">
        <header>
            <h1 style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    style="width: 48px; height: 48px; flex-shrink: 0; margin: 0; padding: 0; display: block; margin-top: -4px;">
                    <path d="M12 2c-2.5 0-4.5 2-4.5 4.5 0 3 4.5 7.5 4.5 7.5s4.5-4.5 4.5-7.5c0-2.5-2-4.5-4.5-4.5z"
                        fill="currentColor" transform="scale(1 -1) translate(0 -24)" />
                </svg>
                <span>Pulse Chain GIKI</span>
            </h1>
            <p>Donate Blood</p>
        </header>


        <div class="card" style="max-width: 700px; margin: 0 auto;">
            <h2 style="text-align: center; color: var(--text-primary); margin-bottom: 30px;">Donor Information Form</h2>
            <p style="text-align: center; color: var(--text-secondary); margin-bottom: 30px;">
                Please fill in your details to register as a blood donor. Your information will help connect you with
                those in need.
            </p>

            <form id="donateForm">
                <div class="form-group">
                    <label for="fullName">Full Name *</label>
                    <input type="text" id="fullName" name="fullName" required>
                </div>

                <div class="form-group">
                    <label for="age">Age *</label>
                    <input type="number" id="age" name="age" min="18" max="65" required>
                </div>

                <div class="form-group">
                    <label>Gender *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="gender" value="Male" required>
                            <span class="radio-label">Male</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="gender" value="Female" required>
                            <span class="radio-label">Female</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="gender" value="Other" required>
                            <span class="radio-label">Other</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Blood Group *</label>
                    <div class="radio-group blood-group-grid">
                        <label class="radio-option">
                            <input type="radio" name="bloodGroup" value="A+" required>
                            <span class="radio-label">A+</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="bloodGroup" value="A-" required>
                            <span class="radio-label">A-</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="bloodGroup" value="B+" required>
                            <span class="radio-label">B+</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="bloodGroup" value="B-" required>
                            <span class="radio-label">B-</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="bloodGroup" value="AB+" required>
                            <span class="radio-label">AB+</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="bloodGroup" value="AB-" required>
                            <span class="radio-label">AB-</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="bloodGroup" value="O+" required>
                            <span class="radio-label">O+</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="bloodGroup" value="O-" required>
                            <span class="radio-label">O-</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="contact">Contact Number *</label>
                    <input type="tel" id="contact" name="contact" required>
                </div>

                <div class="form-group">
                    <label for="medicalNote">Medical Notes (Optional)</label>
                    <textarea id="medicalNote" name="medicalNote"
                        placeholder="Any medical conditions or notes..."></textarea>
                </div>

                <div class="form-group checkbox-group">
                    <label class="checkbox-container">
                        <input type="checkbox" id="agreeTerms" name="agreeTerms" required>
                        <span class="checkbox-label">I agree to share my information with those in need and confirm that
                            all details provided are accurate *</span>
                    </label>
                </div>

                <button type="submit" class="btn btn-primary btn-block">Submit Donor Information</button>
            </form>
        </div>

        <div class="back-to-dashboard-container">
            <a href="index.html" class="btn-back-to-dashboard">‚Üê Back to Dashboard</a>
        </div>
    </div>

    <script type="module">
        import { addDonor } from './js/donor.js';
        import { getCurrentUser, onAuthStateChange } from './js/login.js';
        import { showSuccessToast, showErrorToast } from './js/toast.js';

        const donateForm = document.getElementById('donateForm');

        // Check auth state
        onAuthStateChange((user) => {
            if (!user) {
                window.location.href = 'index.html';
            }
        });

        donateForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const user = getCurrentUser();
            const formData = {
                fullName: document.getElementById('fullName').value,
                age: parseInt(document.getElementById('age').value),
                gender: document.querySelector('input[name="gender"]:checked')?.value || '',
                bloodGroup: document.querySelector('input[name="bloodGroup"]:checked')?.value || '',
                contact: document.getElementById('contact').value,
                availability: 'Yes', // Default to Yes
                medicalNote: document.getElementById('medicalNote').value,
                userEmail: user ? user.email : '',
                userId: user ? user.uid : ''
            };

            const result = await addDonor(formData);

            if (result.success) {
                showSuccessToast('Donor information submitted successfully! Thank you for your contribution.');
                setTimeout(() => {
                    donateForm.reset();
                }, 2000);
            } else {
                showErrorToast(result.error || 'Failed to submit donor information. Please try again.');
            }
        });
    </script>
</body>

</html>