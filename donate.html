<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donate Blood - Pulse Chain GIKI</title>
    <link rel="icon" type="image/png" href="PICS/Pulse Chain GIKI.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/donate.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div id="shimmerOverlay" class="shimmer-overlay">
        <div class="skeleton-sidebar">
            <div class="skeleton-item skeleton-logo">
                <div class="shimmer-effect"></div>
            </div>
            <div class="skeleton-item skeleton-menu-item">
                <div class="shimmer-effect"></div>
            </div>
            <div class="skeleton-item skeleton-menu-item">
                <div class="shimmer-effect"></div>
            </div>
            <div class="skeleton-item skeleton-menu-item">
                <div class="shimmer-effect"></div>
            </div>
            <div class="skeleton-item skeleton-menu-item">
                <div class="shimmer-effect"></div>
            </div>
            <div class="skeleton-item skeleton-menu-item">
                <div class="shimmer-effect"></div>
            </div>
        </div>
        <div class="skeleton-main">
            <div class="skeleton-item skeleton-header">
                <div class="shimmer-effect"></div>
            </div>
            <div class="skeleton-content">
                <div class="skeleton-item skeleton-card">
                    <div class="shimmer-effect"></div>
                </div>
                <div class="skeleton-item skeleton-card" style="height: 300px;">
                    <div class="shimmer-effect"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <main class="main-content">
            <div id="top-header-container"></div>

            <div class="content-area">
                <div class="container">
                    <div class="card" style="max-width: 700px; margin: 0 auto;">
                        <h2
                            style="text-align: center; color: var(--text-primary); margin-bottom: 30px; font-weight: 500;">
                            Donor
                            Information Form</h2>
                        <p style="text-align: center; color: var(--text-secondary); margin-bottom: 30px;">
                            Please fill in your details to register as a blood donor. Your information will help connect
                            you with
                            those in need.
                        </p>

                        <form id="donateForm">
                            <div class="form-group">
                                <label for="fullName">Full Name *</label>
                                <input type="text" id="fullName" name="fullName" required>
                            </div>

                            <div class="form-group">
                                <label for="age">Age *</label>
                                <input type="number" id="age" name="age" min="18" max="65" required>
                            </div>

                            <div class="form-group">
                                <label>Gender *</label>
                                <div class="radio-group">
                                    <label class="radio-option">
                                        <input type="radio" name="gender" value="Male" required>
                                        <span class="radio-label">Male</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="gender" value="Female" required>
                                        <span class="radio-label">Female</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="gender" value="Other" required>
                                        <span class="radio-label">Other</span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Blood Group *</label>
                                <div class="radio-group blood-group-grid">
                                    <label class="radio-option">
                                        <input type="radio" name="bloodGroup" value="A+" required>
                                        <span class="radio-label">A+</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="bloodGroup" value="A-" required>
                                        <span class="radio-label">A-</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="bloodGroup" value="B+" required>
                                        <span class="radio-label">B+</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="bloodGroup" value="B-" required>
                                        <span class="radio-label">B-</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="bloodGroup" value="AB+" required>
                                        <span class="radio-label">AB+</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="bloodGroup" value="AB-" required>
                                        <span class="radio-label">AB-</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="bloodGroup" value="O+" required>
                                        <span class="radio-label">O+</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="bloodGroup" value="O-" required>
                                        <span class="radio-label">O-</span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="contact">Contact Number *</label>
                                <input type="tel" id="contact" name="contact" required>
                            </div>

                            <div class="form-group">
                                <label for="medicalNote">Medical Notes (Optional)</label>
                                <textarea id="medicalNote" name="medicalNote"
                                    placeholder="Any medical conditions or notes..."></textarea>
                            </div>

                            <div class="form-group checkbox-group">
                                <div class="checkbox-container">
                                    <label class="custom-checkbox">
                                        <input type="checkbox" id="agreeTerms" name="agreeTerms" required>
                                        <svg viewBox="0 0 64 64" height="18px" width="18px">
                                            <path
                                                d="M 0 16 V 56 A 8 8 90 0 0 8 64 H 56 A 8 8 90 0 0 64 56 V 8 A 8 8 90 0 0 56 0 H 8 A 8 8 90 0 0 0 8 V 16 L 32 48 L 64 16 V 8 A 8 8 90 0 0 56 0 H 8 A 8 8 90 0 0 0 8 V 56 A 8 8 90 0 0 8 64 H 56 A 8 8 90 0 0 64 56 V 16"
                                                pathLength="575.0541381835938" class="path"></path>
                                        </svg>
                                    </label>
                                    <label for="agreeTerms" class="checkbox-label"
                                        style="cursor: pointer; margin-top: 2px;">
                                        I agree to share my information with those in need and
                                        confirm that all details provided are accurate <span class="required"
                                            style="color: red;">*</span>
                                    </label>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary btn-block">Submit Donor Information</button>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Profile Modal -->
    <div id="profile-modal-container"></div>

    <script type="module">
        import { addDonor } from './js/donor.js';
        import { getCurrentUser, onAuthStateChange, logOut } from './js/login.js';
        import { showSuccessToast, showErrorToast } from './js/toast.js';
        import { initializeDashboardComponents } from './js/components.js';

        const donateForm = document.getElementById('donateForm');

        // Initialize dashboard components
        initializeDashboardComponents({
            activePage: 'donate',
            headerTitle: 'Donate Blood',
            searchPlaceholder: 'Search donors, requests...'
        });

        // Select DOM elements
        const userNameSpan = document.getElementById('userName');
        const userRole = document.getElementById('userRole');
        const userAvatar = document.getElementById('userAvatar');
        const userProfile = document.getElementById('userProfile');
        const profileModal = document.getElementById('profileModal');
        const closeProfileModal = document.getElementById('closeProfileModal');
        const profileLogoutBtn = document.getElementById('profileLogoutBtn');

        if (profileLogoutBtn) {
            profileLogoutBtn.addEventListener('click', async () => {
                const result = await logOut();
                if (result.success) {
                    sessionStorage.removeItem('adminLoggedIn');
                    sessionStorage.removeItem('adminEmail');
                    profileModal.style.display = 'none';
                    showSuccessToast('Logged out successfully!');
                    // onAuthStateChange will handle redirect
                }
            });
        }

        // Check auth state
        onAuthStateChange((user) => {
            if (!user) {
                window.location.href = `${window.getPath('login')}?redirect=${window.getPath('donate')}`;
            } else {
                // Update Sidebar UI
                const displayName = user.displayName || user.email || 'User';
                if (userNameSpan) userNameSpan.textContent = displayName;
                if (userRole) userRole.textContent = 'User';

                if (userAvatar) {
                    if (displayName && displayName !== 'User') {
                        userAvatar.innerHTML = `<span
                            style="font-size: 16px; font-weight: 700;">${displayName.charAt(0).toUpperCase()}</span>`;
                    } else {
                        userAvatar.innerHTML = '<span style="font-size: 16px; font-weight: 700;">U</span>';
                    }
                }

                if (userProfile) userProfile.style.cursor = 'pointer';
            }
        });

        donateForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const user = getCurrentUser();
            const formData = {
                fullName: document.getElementById('fullName').value,
                age: parseInt(document.getElementById('age').value),
                gender: document.querySelector('input[name="gender"]:checked')?.value || '',
                bloodGroup: document.querySelector('input[name="bloodGroup"]:checked')?.value || '',
                contact: document.getElementById('contact').value,
                availability: 'Yes', // Default to Yes
                medicalNote: document.getElementById('medicalNote').value,
                userEmail: user ? user.email : '',
                userId: user ? user.uid : ''
            };

            const result = await addDonor(formData);

            if (result.success) {
                showSuccessToast('Donor information submitted successfully! Thank you for your contribution.');
                setTimeout(() => {
                    donateForm.reset();
                }, 2000);
            } else {
                showErrorToast(result.error || 'Failed to submit donor information. Please try again.');
            }
        });
    </script>
</body>

</html>