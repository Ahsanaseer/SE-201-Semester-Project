<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pulse Chain GIKI</title>
    <link rel="icon" type="image/png" href="PICS/Pulse Chain GIKI.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div id="shimmerOverlay" class="shimmer-overlay">
        <div class="skeleton-sidebar">
            <div class="skeleton-item skeleton-logo">
                <div class="shimmer-effect"></div>
            </div>
            <div class="skeleton-item skeleton-menu-item">
                <div class="shimmer-effect"></div>
            </div>
            <div class="skeleton-item skeleton-menu-item">
                <div class="shimmer-effect"></div>
            </div>
            <div class="skeleton-item skeleton-menu-item">
                <div class="shimmer-effect"></div>
            </div>
            <div class="skeleton-item skeleton-menu-item">
                <div class="shimmer-effect"></div>
            </div>
            <div class="skeleton-item skeleton-menu-item">
                <div class="shimmer-effect"></div>
            </div>
        </div>
        <div class="skeleton-main">
            <div class="skeleton-item skeleton-header">
                <div class="shimmer-effect"></div>
            </div>
            <div class="skeleton-content">
                <div class="skeleton-item skeleton-card">
                    <div class="shimmer-effect"></div>
                </div>
                <div class="skeleton-item skeleton-card" style="height: 300px;">
                    <div class="shimmer-effect"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Header -->
            <div id="top-header-container"></div>


            <!-- Content Area -->
            <div class="content-area">
                <div id="alertContainer" class="alert-container"></div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">My Donations</div>
                        <div class="stat-value" id="myDonationsCount">0</div>
                        <div class="stat-change">Total times donated</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">My Requests</div>
                        <div class="stat-value" id="myRequestsCount">0</div>
                        <div class="stat-change">Blood requests made</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Available Now</div>
                        <div class="stat-value" id="myAvailability">-</div>
                        <div class="stat-change">Check availability</div>
                    </div>
                </div>

                <!-- Hero Card -->
                <div class="hero-card">
                    <div class="hero-label">PULSE CHAIN GIKI</div>
                    <h2 class="hero-title" id="heroTitle">Your Gateway to Saving Lives</h2>
                    <p class="hero-description">Join our community of donors and help save lives. Every donation makes a
                        difference. Register as a donor or request blood when needed.</p>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <a href="donate.html" class="hero-button"
                            style="text-decoration: none; display: inline-block;">Register as Donor</a>
                        <a href="request.html" class="hero-button"
                            style="text-decoration: none; display: inline-block;">Request Blood</a>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="data-section">
                    <div class="section-header">
                        <h2 class="section-title">Quick Actions</h2>
                    </div>
                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 24px;">
                        <a href="donate.html" class="stat-card"
                            style="text-decoration: none; color: inherit; cursor: pointer;">
                            <div style="width: 48px; height: 48px; margin: 0 auto 16px; color: var(--accent-purple);">
                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path
                                        d="M12 2c-2.5 0-4.5 2-4.5 4.5 0 3 4.5 7.5 4.5 7.5s4.5-4.5 4.5-7.5c0-2.5-2-4.5-4.5-4.5z"
                                        fill="currentColor" transform="scale(1 -1) translate(0 -24)" />
                                </svg>
                            </div>
                            <div class="stat-label" style="text-align: center;">Donate Blood</div>
                            <div
                                style="text-align: center; color: var(--text-secondary); font-size: 14px; margin-top: 8px;">
                                Register yourself as a blood donor and help save lives
                            </div>
                        </a>
                        <a href="request.html" class="stat-card"
                            style="text-decoration: none; color: inherit; cursor: pointer;">
                            <div style="width: 48px; height: 48px; margin: 0 auto 16px; color: var(--accent-purple);">
                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <circle cx="11" cy="11" r="8" />
                                    <path d="m21 21-4.35-4.35" />
                                </svg>
                            </div>
                            <div class="stat-label" style="text-align: center;">Request Blood</div>
                            <div
                                style="text-align: center; color: var(--text-secondary); font-size: 14px; margin-top: 8px;">
                                Search for available blood donors in your area
                            </div>
                        </a>

                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="data-section">
                    <div class="section-header">
                        <h2 class="section-title">Recent Activity</h2>
                        <div class="section-tabs">
                            <button class="tab-button active">All</button>
                            <button class="tab-button">Donations</button>
                            <button class="tab-button">Requests</button>
                        </div>
                    </div>
                    <div id="recentActivityContainer"
                        style="padding: 40px; text-align: center; color: var(--text-secondary);">
                        <div
                            style="width: 48px; height: 48px; margin: 0 auto 16px; opacity: 0.5; color: var(--text-secondary);">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
                                <rect x="8" y="2" width="8" height="4" rx="1" ry="1" />
                            </svg>
                        </div>
                        <div style="font-size: 16px;">No recent activity</div>
                        <div style="font-size: 14px; margin-top: 8px; opacity: 0.7;">Start by donating blood or making a
                            request</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Profile</h2>
                <button class="modal-close" id="closeProfileModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="profile-content">
                    <div class="profile-avatar-section">
                        <div class="profile-avatar-large" id="profileAvatarLarge">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                                <circle cx="12" cy="7" r="4" />
                            </svg>
                        </div>
                        <h3 id="profileName">User</h3>
                        <p id="profileEmail" class="profile-email">user@example.com</p>
                    </div>

                    <div class="profile-info-section">
                        <div class="profile-info-item">
                            <label>Full Name</label>
                            <div class="profile-info-value" id="profileDisplayName">-</div>
                        </div>
                        <div class="profile-info-item">
                            <label>Email</label>
                            <div class="profile-info-value" id="profileEmailValue">-</div>
                        </div>
                        <div class="profile-info-item">
                            <label>Role</label>
                            <div class="profile-info-value">User</div>
                        </div>
                        <div class="profile-info-item">
                            <label>Member Since</label>
                            <div class="profile-info-value" id="profileMemberSince">-</div>
                        </div>
                    </div>

                    <div class="profile-actions">
                        <button class="btn btn-primary btn-block" id="editProfileBtn">Edit Profile</button>
                        <button class="btn btn-secondary btn-block" id="profileLogoutBtn">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="3" y1="12" x2="21" y2="12" />
            <line x1="3" y1="6" x2="21" y2="6" />
            <line x1="3" y1="18" x2="21" y2="18" />
        </svg>
    </button>

    <div id="mobile-menu-toggle-container"></div>
    <!-- Profile Modal -->
    <div id="profile-modal-container"></div>

    <script type="module">
        import { initializeDashboardComponents } from './js/components.js';
        import { getCurrentUser, logOut, onAuthStateChange, signIn } from './js/login.js';
        import { getUserDonations } from './js/donor.js';
        import { getUserRequests } from './js/request.js';
        import { showSuccessToast, showErrorToast } from './js/toast.js';

        initializeDashboardComponents({
            activePage: 'home',
            headerTitle: 'Dashboard',
            searchPlaceholder: 'Search donors, requests...'
        });

        const userNameSpan = document.getElementById('userName');
        const userRole = document.getElementById('userRole');
        const userAvatar = document.getElementById('userAvatar');
        const userProfile = document.getElementById('userProfile');
        const logoutBtn = document.getElementById('logoutBtn');
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const sidebar = document.getElementById('sidebar');
        const heroTitle = document.getElementById('heroTitle');

        let isLoggedIn = false;

        // Initialize dashboard components


        // Initialize UI to logged-out state
        function initializeLoggedOutState() {
            isLoggedIn = false;
            userNameSpan.textContent = 'Login';
            userRole.textContent = 'Click to sign in';
            heroTitle.textContent = 'Your Gateway to Saving Lives';
            userAvatar.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>';
            logoutBtn.style.display = 'none';
            userProfile.style.cursor = 'pointer';

            // Reset stats
            if (document.getElementById('myDonationsCount')) document.getElementById('myDonationsCount').textContent = '0';
            if (document.getElementById('myRequestsCount')) document.getElementById('myRequestsCount').textContent = '0';
            if (document.getElementById('myAvailability')) document.getElementById('myAvailability').textContent = '-';
        }

        // Initialize with logged-out state first
        initializeLoggedOutState();

        // Mobile menu toggle
        mobileMenuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('open');
        });

        // Open profile modal when clicking profile
        const profileModal = document.getElementById('profileModal');
        const closeProfileModal = document.getElementById('closeProfileModal');
        const profileLogoutBtn = document.getElementById('profileLogoutBtn');

        // Function to open profile modal
        function openProfileModal() {
            if (!isLoggedIn) {
                window.location.href = 'login.html';
            } else {
                // Update profile modal with current user data
                const user = getCurrentUser();
                if (user) {
                    document.getElementById('profileName').textContent = user.displayName || user.email || 'User';
                    document.getElementById('profileEmail').textContent = user.email || '-';
                    document.getElementById('profileDisplayName').textContent = user.displayName || '-';
                    document.getElementById('profileEmailValue').textContent = user.email || '-';

                    // Set avatar
                    const profileAvatarLarge = document.getElementById('profileAvatarLarge');
                    if (user.displayName) {
                        profileAvatarLarge.innerHTML = `<span style="font-size: 32px; font-weight: 400;">${user.displayName.charAt(0).toUpperCase()}</span>`;
                    } else {
                        profileAvatarLarge.innerHTML = '<span style="font-size: 32px; font-weight: 400;">U</span>';
                    }

                    // Set member since date
                    if (user.metadata && user.metadata.creationTime) {
                        const createdDate = new Date(user.metadata.creationTime);
                        document.getElementById('profileMemberSince').textContent = createdDate.toLocaleDateString();
                    } else {
                        document.getElementById('profileMemberSince').textContent = '-';
                    }
                }
                profileModal.style.display = 'flex';
            }
        }



        // Logout from profile modal
        profileLogoutBtn.addEventListener('click', async () => {
            const result = await logOut();
            if (result.success) {
                sessionStorage.removeItem('adminLoggedIn');
                sessionStorage.removeItem('adminEmail');
                profileModal.style.display = 'none';
                showSuccessToast('Logged out successfully!');
                // UI will update via onAuthStateChange
            }
        });

        // Current filter state
        let currentActivityFilter = 'all'; // 'all', 'donations', 'requests'
        let currentUserEmail = null;

        // Function to load and display recent activity
        async function loadRecentActivity(userEmail, filter = 'all') {
            const activityContainer = document.getElementById('recentActivityContainer');
            if (!activityContainer) return;

            currentUserEmail = userEmail;
            currentActivityFilter = filter;

            try {
                let donations = [];
                let requests = [];

                // Load donations if needed
                if (filter === 'all' || filter === 'donations') {
                    const donationsResult = await getUserDonations(userEmail);
                    if (donationsResult.success && donationsResult.donations) {
                        donations = donationsResult.donations.map(d => ({ ...d, type: 'donation' }));
                    }
                }

                // Load requests if needed
                if (filter === 'all' || filter === 'requests') {
                    const requestsResult = await getUserRequests(userEmail);
                    if (requestsResult.success && requestsResult.requests) {
                        requests = requestsResult.requests.map(r => ({ ...r, type: 'request' }));
                    }
                }

                // Combine and sort by date
                let allActivities = [];
                if (filter === 'all') {
                    allActivities = [...donations, ...requests];
                } else if (filter === 'donations') {
                    allActivities = donations;
                } else if (filter === 'requests') {
                    allActivities = requests;
                }

                // Sort by timestamp descending (most recent first)
                allActivities.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                if (allActivities.length > 0) {
                    // Display activities
                    let html = '<div style="display: flex; flex-direction: column; gap: 16px; text-align: left;">';

                    allActivities.slice(0, 10).forEach(activity => {
                        const date = new Date(activity.timestamp);
                        const formattedDate = date.toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'short',
                            day: 'numeric'
                        });

                        if (activity.type === 'donation') {
                            html += `
                                <div style="background: var(--card-bg); border-radius: 0.5rem; padding: 16px; border-left: 3px solid #3b82f6;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                                        <div style="flex: 1;">
                                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                                <span style="font-size: 11px; font-weight: 500; color: #3b82f6; background: rgba(59, 130, 246, 0.1); padding: 2px 8px; border-radius: 4px;">DONATION</span>
                                                <div style="font-size: 16px; color: var(--text-primary); font-weight: 500;">${activity.fullName}</div>
                                            </div>
                                            <div style="font-size: 14px; color: var(--text-secondary);">
                                                Blood Group: <span style="color: var(--text-primary);">${activity.bloodGroup}</span>  
                                                Availability: <span style="color: ${activity.availability === 'Yes' ? '#28a745' : '#dc3545'}">${activity.availability}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="font-size: 12px; color: var(--text-secondary); margin-top: 8px; opacity: 0.7;">${formattedDate}</div>
                                </div>
                            `;
                        } else if (activity.type === 'request') {
                            const statusColor = activity.status === 'completed' ? '#10b981' : '#f59e0b';
                            const statusText = activity.status === 'completed' ? 'Completed' : 'Pending';
                            html += `
                                <div style="background: var(--card-bg); border-radius: 0.5rem; padding: 16px; border-left: 3px solid #ef4444;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                                        <div style="flex: 1;">
                                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                                <span style="font-size: 11px; font-weight: 500; color: #ef4444; background: rgba(239, 68, 68, 0.1); padding: 2px 8px; border-radius: 4px;">REQUEST</span>
                                                <div style="font-size: 16px; color: var(--text-primary); font-weight: 500;">Blood Group: ${activity.bloodGroup}</div>
                                            </div>
                                            <div style="font-size: 14px; color: var(--text-secondary);">
                                                ${activity.requestedDonorName ? `Requested from: <span style="color: var(--text-primary);">${activity.requestedDonorName}</span>` : ''}
                                                Status: <span style="color: ${statusColor}">${statusText}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="font-size: 12px; color: var(--text-secondary); margin-top: 8px; opacity: 0.7;">${formattedDate}</div>
                                </div>
                            `;
                        }
                    });

                    html += '</div>';
                    activityContainer.innerHTML = html;
                    activityContainer.style.textAlign = 'left';
                    activityContainer.style.padding = '20px';
                } else {
                    // No activities found
                    const emptyMessage = filter === 'donations'
                        ? 'No donations found. Start by donating blood!'
                        : filter === 'requests'
                            ? 'No requests found. Make a blood request!'
                            : 'No recent activity. Start by donating blood or making a request';

                    activityContainer.innerHTML = `
                        <div style="width: 48px; height: 48px; margin: 0 auto 16px; opacity: 0.5; color: var(--text-secondary);">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
                                <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
                            </svg>
                        </div>
                        <div style="font-size: 16px;">No recent activity</div>
                        <div style="font-size: 14px; margin-top: 8px; opacity: 0.7;">${emptyMessage}</div>
                    `;
                    activityContainer.style.textAlign = 'center';
                    activityContainer.style.padding = '40px';
                }
            } catch (error) {
                console.error('Error loading recent activity:', error);
                activityContainer.innerHTML = `
                    <div style="font-size: 14px; color: var(--text-secondary);">Unable to load recent activity</div>
                `;
            }
        }

        // Tab button event listeners for Recent Activity section
        function setupActivityTabs() {
            // Find the Recent Activity section by finding the section that contains recentActivityContainer
            const activityContainer = document.getElementById('recentActivityContainer');
            if (!activityContainer) return;

            const activitySection = activityContainer.closest('.data-section');
            if (!activitySection) return;

            const tabButtons = activitySection.querySelectorAll('.section-tabs .tab-button');

            // Remove existing listeners by cloning and replacing
            tabButtons.forEach((button) => {
                const newButton = button.cloneNode(true);
                button.parentNode.replaceChild(newButton, button);
            });

            // Add new event listeners
            const newTabButtons = activitySection.querySelectorAll('.section-tabs .tab-button');
            newTabButtons.forEach((button) => {
                button.addEventListener('click', () => {
                    // Remove active class from all buttons in this section
                    newTabButtons.forEach(btn => btn.classList.remove('active'));
                    // Add active class to clicked button
                    button.classList.add('active');

                    // Determine filter based on button text
                    const filter = button.textContent.trim().toLowerCase();
                    const filterMap = {
                        'all': 'all',
                        'donations': 'donations',
                        'requests': 'requests'
                    };

                    const selectedFilter = filterMap[filter] || 'all';

                    // Reload activity with new filter
                    if (currentUserEmail) {
                        loadRecentActivity(currentUserEmail, selectedFilter);
                    }
                });
            });
        }

        // Setup tabs after DOM is ready
        setTimeout(() => {
            setupActivityTabs();
        }, 100);

        // Check auth state
        onAuthStateChange(async (user) => {
            // Wait a moment to ensure Firebase has fully initialized
            await new Promise(resolve => setTimeout(resolve, 100));

            if (user) {
                isLoggedIn = true;
                const displayName = user.displayName || user.email || 'User';
                const firstName = displayName.split(' ')[0]; // Get first name for greeting

                // Update profile section - show name instead of email
                userNameSpan.textContent = displayName;
                userRole.textContent = 'User';

                // Update hero title with greeting
                if (user.displayName) {
                    heroTitle.textContent = `Hello, ${firstName}`;
                } else {
                    heroTitle.textContent = 'Your Gateway to Saving Lives';
                }

                if (displayName && displayName !== 'User') {
                    userAvatar.innerHTML = `<span style="font-size: 16px; font-weight: 700;">${displayName.charAt(0).toUpperCase()}</span>`;
                } else {
                    userAvatar.innerHTML = '<span style="font-size: 16px; font-weight: 700;">U</span>';
                }

                logoutBtn.style.display = 'block';
                userProfile.style.cursor = 'default';

                // Fetch and display stats
                try {
                    // Fetch donations (using donor records as proxy for now)
                    const donationsResult = await getUserDonations(user.email);
                    if (donationsResult.success) {
                        if (document.getElementById('myDonationsCount')) {
                            document.getElementById('myDonationsCount').textContent = donationsResult.donations.length;
                        }

                        // Check availability from latest donor record
                        if (donationsResult.donations.length > 0) {
                            const latestDonorRecord = donationsResult.donations[0];
                            const availabilityElement = document.getElementById('myAvailability');
                            if (availabilityElement) {
                                availabilityElement.textContent = latestDonorRecord.availability;
                                availabilityElement.style.color = latestDonorRecord.availability === 'Yes' ? '#28a745' : '#dc3545';
                            }
                        } else {
                            if (document.getElementById('myAvailability')) {
                                document.getElementById('myAvailability').textContent = 'No';
                                document.getElementById('myAvailability').style.color = 'var(--text-secondary)';
                            }
                        }
                    }

                    // Fetch requests
                    const requestsResult = await getUserRequests(user.email);
                    if (requestsResult.success) {
                        if (document.getElementById('myRequestsCount')) {
                            document.getElementById('myRequestsCount').textContent = requestsResult.requests.length;
                        }
                    }

                } catch (error) {
                    console.error("Error fetching stats:", error);
                }

                // Load recent activity for logged-in user
                if (user.email) {
                    loadRecentActivity(user.email);
                    // Setup tabs after loading activity
                    setTimeout(() => {
                        setupActivityTabs();
                    }, 200);
                }
            } else {
                // No user - ensure logged-out state
                initializeLoggedOutState();

                // Reset recent activity
                const activityContainer = document.getElementById('recentActivityContainer');
                if (activityContainer) {
                    activityContainer.innerHTML = `
                        <div style="width: 48px; height: 48px; margin: 0 auto 16px; opacity: 0.5; color: var(--text-secondary);">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
                                <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
                            </svg>
                        </div>
                        <div style="font-size: 16px;">No recent activity</div>
                        <div style="font-size: 14px; margin-top: 8px; opacity: 0.7;">Start by donating blood or making a request</div>
                    `;
                }
            }
        });

        // Logout
        logoutBtn.addEventListener('click', async () => {
            const result = await logOut();
            if (result.success) {
                sessionStorage.removeItem('adminLoggedIn');
                sessionStorage.removeItem('adminEmail');
                showSuccessToast('Logged out successfully!');
                // UI will update via onAuthStateChange
            }
        });

        // Top header background on scroll
        const topHeader = document.querySelector('.top-header');
        if (topHeader) {
            let lastScrollTop = 0;

            window.addEventListener('scroll', () => {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

                if (scrollTop > 50) {
                    topHeader.classList.add('scrolled');
                } else {
                    topHeader.classList.remove('scrolled');
                }

                lastScrollTop = scrollTop;
            });
        }
    </script>
</body>

</html>